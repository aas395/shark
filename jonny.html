<!DOCTYPE html>
<html>
	<head>
		<title>SharkVR</title>
		<meta name="description" content="SharkVR Game">
		<script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
		<script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.4/dist/aframe-extras.min.js"></script>
		<script src="https://cdn.rawgit.com/ngokevin/aframe-physics-components/master/dist/aframe-physics-components.min.js"></script>
		<script>
		        		
		    AFRAME.registerComponent("listener", {
		    schema : 
				{
					forwardFactor : {
						type : "number",
						default : 1
					},
					target: {
						type: 'selector'
					},
					distance: {
						type: 'vec3'
					}
				},
        
				init: function() {
					var playerEl = document.querySelector('#character');
					
					playerEl.addEventListener('collide', function (e) {
						console.log('collision, mothafucka')
						
						e.detail.target.el;  // Original entity (playerEl).
						e.detail.body.el;    // Other entity, which playerEl touched.
						e.detail.contact;    // Stats about the collision (CANNON.ContactEquation).
						e.detail.contact.ni; // Normal (direction) of the collision (CANNON.Vec3).
					});
				},
				tick : function()
				{	
					const targetItem = this.data.target;
					var distance = this.data.distance;
					var targetPosition = targetItem.getAttribute('position');
					
					const direction = this.el.components.camera.camera.getWorldDirection();
					
					this.el.setAttribute('position',{
						x: targetPosition.x + direction.x,
						y: targetPosition.y + direction.y,
						z: targetPosition.z + -this.data.forwardFactor //Constant speed
					});
					
				}
			});
	//Using the date/time is the only thing I could think to use as a timer
		// Gets the initial time
		var initialTime = new Date().getTime();

		// Update the count down every 1 second
		var x = setInterval(function() {

			// Get todays date and time
			var now = new Date().getTime();

			// Find the distance between now and the initial time
			var distance = now - initialTime;

			// Time calculations for days, hours, minutes and seconds, might not use days
			//var days = Math.floor(distance / (1000 * 60 * 60 * 24)); //Saved this code just in case
			//var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
			var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
			var seconds = Math.floor((distance % (1000 * 60)) / 1000);
  
			// Display the result in the element with id="demo"
			document.getElementById("timer").setAttribute('text', 'value: ' + minutes + "m " + seconds + "s ;");
      console.log(minutes + "m " + seconds + "s ")
			// When the player dies or reaches x amount of points 

				if (distance < 0) { 
						//clearInterval(x);		
					}
				}, 1000);
			
		//End of Timer Script
	 </script>
	</head>
	<body>
		
	<asset>
		<a-mixin id="build" geometry="primitive: box" material="shader: standard; metalness: 0.6"></a-mixin>
	</asset> 
 
 <!-- Fog for dimming objects in distance -->
 <a-scene physics="gravity: 0;" fog="type: linear; color: #40a4df; far: 2200; near: 0;">


<!-- Digital Worlds -->
<a-entity id="floor" static-body geometry="primitive: plane; height: 8000; width: 8000" position="0 -1 -5" rotation="-90 0 0" material="shader: flat; color: #40a4df; repeat: 80 80">
	 </a-entity>

<!-- Buildings -->
<a-entity id="1" static-body mixin="build" geometry="depth: 150; width: 150; height: 140;" position="110 69 1500" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="2" static-body mixin="build" geometry="depth: 150; width: 150; height: 140;" position="-60 69 1500" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="3" static-body mixin="build" geometry="depth: 150; width: 150; height: 140;" position="0 69 700" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="4" static-body mixin="build" geometry="depth: 75; width: 75; height: 300;" position="85 145 800" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="5" static-body mixin="build" geometry="depth: 150; width: 150; height: 140;" position="135 69 500" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="6" static-body mixin="build" geometry="depth: 75; width: 75; height: 300;" position="-90 145 460" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="7" static-body mixin="build" geometry="depth: 150; width: 150; height: 140;" position="-150 69 200" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>
<a-entity id="8" static-body mixin="build" geometry="depth: 75; width: 75; height: 300;" position="100 145 260" material="src: url(https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ftexture.jpg?1490308149272)"></a-entity>


<!-- Camera -->
<a-entity id="character" position="0 10 1000" kinematic-body listener="target: #character" camera universal-controls>
  <a-entity class="health" geometry="primitive: plane; width: 0.6; height: 0.1;" position="0 0.5 -0.9" rotation="40 0 0" material="shader: flat; opacity: 0.8; transparent: true; src: url(images/health-bar.png)">;;
    <a-entity id="timer"></a-entity>
  </a-entity>
</a-entity>


			<!-- Lighting and background -->
			<a-sky color="#cccccc"></a-sky>
	 
		</a-scene>



	</body>
	
</html>